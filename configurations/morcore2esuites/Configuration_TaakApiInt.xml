<Module xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../FrankConfig.xsd">
    <Adapter name="NewResponse_Notification">
        <Receiver name="Response_Notification">
            <JavaListener name="Response_Notification"/>
        </Receiver>

        <Pipeline>

            <Exits>
                <Exit name="Exit" state="SUCCESS"/>
                <Exit name="failure" state="REJECTED"/>
            </Exits>

        <SenderPipe name="Send2MorCore">
            <HttpSender name="GetNotification" methodType="GET" url="/melding/{uuid}"/>
            <Forward name="success" path="Json2Xml"/>
        </SenderPipe>

        <JsonPipe name="Json2Xml" direction="JSON2XML" prettyPrint="true">
            <Forward name="success" path="JuisteFormat"/>
            <Forward name="Exception" path="failure"/>
        </JsonPipe>

        <XsltPipe name="JuisteFormat" styleSheetName="xsl/TaakApiInt/GetNotification.xsl" outputType="XML">
            <Forward name="success" path="XmlCheck"/>
            <Forward name="Exception" path="failure"/>
        </XsltPipe>

        <XmlValidatorPipe name="XmlCheck" schema="xsd/TaakApiInt/ValidateGetMelding.xsd" root="root">
            <Forward name="success" path="Xml2Json"/>
            <Forward name="Exception" path="failure"/>
        </XmlValidatorPipe>

        <JsonPipe name="Xml2Json" direction="XML2JSON">
            <Forward name="success" path="Exit"/>
            <Forward name="Exception" path="failure"/>
        </JsonPipe>

        <!-- Mogelijke config update mogelijk ZIE HIERONDER!

        <JsonXsltPipe name="CorrectResponse" styleSheetName="xsl/TaakApiInt/GetNotification.xsl">
            <Forward name="success" path="JsonValidator"/>
            <Forward name="Exception" path="failure"/>
        </JsonXsltPipe>

        <Json2XmlValidatorPipe name="JsonValidator" schema="xsd/TaakApiInt/ValidateGetMelding.xsd" root="root" inputFormatSessionKey="InputFormat" outputFormat="JSON">
            <Forward name="success" path="Exit"/>
            <Forward name="Exception" path="failure"/>
        </Json2XmlValidatorPipe> -->

        </Pipeline>
    </Adapter>

    <Adapter name="NewResponse_NotificationTasks">
        <Receiver name="Response_NotificationTasks">
            <JavaListener name="Response_Notificationtasks"/>
        </Receiver>

        <Pipeline>

            <Exits>
                <Exit name="Exit" state="SUCCESS"/>
                <Exit name="failure" state="REJECTED"/>
            </Exits>

        <SenderPipe name="Send2MorCore">
            <HttpSender name="GetNotificationTasks" methodType="GET" url="/melding/{meldingUuid}/taakopdracht"/>
            <Forward name="success" path="Json2Xml"/>
        </SenderPipe>

        <JsonPipe name="Json2Xml" direction="JSON2XML" prettyPrint="true">
            <Forward name="success" path="JuisteFormat"/>
            <Forward name="Exception" path="failure"/>
        </JsonPipe>

        <XsltPipe name="JuisteFormat" styleSheetName="xsl/TaakApiInt/GetNotificationTasks.xsl" outputType="XML">
            <Forward name="success" path="XmlCheck"/>
            <Forward name="Exception" path="failure"/>
        </XsltPipe>

        <XmlValidatorPipe name="XmlCheck" schema="xsd/TaakApiInt/ValidateGetMeldingTaak.xsd" root="root">
            <Forward name="success" path="Xml2Json"/>
            <Forward name="Exception" path="failure"/>
        </XmlValidatorPipe>

        <JsonPipe name="Xml2Json" direction="XML2JSON">
            <Forward name="success" path="Exit"/>
            <Forward name="Exception" path="failure"/>
        </JsonPipe>

        <!-- Mogelijke config update mogelijk ZIE HIERONDER!
            
            <JsonXsltPipe name="CorrectResponse" styleSheetName="xsl/TaakApiInt/GetNotificationTasks.xsl">
            <Forward name="success" path="JsonValidator"/>
            <Forward name="failure" path="Exception"/>
        </JsonXsltPipe>

        <Json2XmlValidatorPipe name="JsonValidator" schema="xsd/TaakApiInt/ValidateGetMeldingTaak.xsd" root="root" inputFormatSessionKey="InputFormat" outputFormat="JSON">
            <Forward name="success" path="Exit"/>
            <Forward name="failure" path="Exception"/>
        </Json2XmlValidatorPipe>  -->

        </Pipeline>
    </Adapter>

    <Adapter name="NewResponse_PostNewTask">
        <Receiver name="Response_PostNewTask">
            <JavaListener name="Response_PostNewTask"/>
        </Receiver>
    
        <Pipeline>

            <Exits>
                <Exit name="Exit" state="SUCCESS"/>
                <Exit name="Exception" state="ERROR"/>
            </Exits>

        <!-- xsltpipe om format kloppend te maken voor verzending -->
        <JsonXsltPipe name="FormatMorCore" styleSheetName="xsl/TaakApiInt/PostNewTask.xsl">
            <Forward name="success" path="JsonInputValidator"/>
            <Forward name="failure" path="Exception"/>
        </JsonXsltPipe>

        <Json2XmlValidatorPipe name="JsonInputValidator" schema="xsd/TaakApiInt/ValidatePostTaakInput.xsd" root="root" outputFormat="JSON">
            <Forward name="success" path="SendToMorCore"/>
            <Forward name="failure" path="Exception"/>
        </Json2XmlValidatorPipe> 

        <SenderPipe name="SendToMorCore">
            <IbisLocalSender name="PostNewTaakopdracht" javaListener="Request_PostZaak"/>
        </SenderPipe>

        <!-- xsltpipe om format kloppend te maken voor Esuites-->
        <JsonXsltPipe name="FormatEsuites" styleSheetName="xsl/TaakApiInt/PostNewTaskResponse.xsl">
            <Forward name="success" path="JsonOutputValidator"/>
            <Forward name="failure" path="Exception"/>
        </JsonXsltPipe>

        <Json2XmlValidatorPipe name="JsonOutputValidator" schema="xsd/TaakApiInt/ValidatePostTaakOutput.xsd" root="root">
            <Forward name="success" path="Exit"/>
            <Forward name="failure" path="Exception"/>
        </Json2XmlValidatorPipe> 
        
        </Pipeline>
    </Adapter>

    <Adapter name="NewResponse_TaskNotification">
        <Receiver name="Response_TaskNotification">
            <JavaListener name="Response_TaskNotification"/>
        </Receiver>

        <Pipeline>

            <Exits>
                <Exit name="Exit" state="SUCCESS"/>
            </Exits>

        </Pipeline>
    </Adapter>
</Module>