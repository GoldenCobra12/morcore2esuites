<Module xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../FrankConfig.xsd">
    <Adapter name="Action_ListTaakTypes">
        <Receiver name="ListTaakTypes">
            <ApiListener
                name="ListTaakTypes"
                uriPattern="/taaktypes" />
        </Receiver>

        <Pipeline>
            <Exits>
                <Exit name="Exit" state="SUCCESS" />
                <Exit name="Reject" state="REJECTED"/>
                <Exit name="Exception" state="ERROR"/>
             </Exits>
            
            <FixedResultPipe name="InputTaaktypesLijst" filename="responses/ZaakTypes.xml"/>

           <XmlValidatorPipe name="ValidateInputMessage" schema="xsd/validateGetTaakTypes.xsd" root="root">
                <Forward name="success" path="XmlToJson"/>
                <Forward name="exception" path="Exception"/>
                <Forward name="failure" path="Reject"/>
            </XmlValidatorPipe>
            
            <JsonPipe name="XmlToJson" direction="XML2JSON">
                <Forward name="success" path="Exit"/>
                <Forward name="failure" path="Exception"/>
            </JsonPipe>
        </Pipeline>
    </Adapter>

    <Adapter name="Action_GetTaakType">
        <Receiver name="GetTaakType">
            <ApiListener
                name="GetTaakType"
                uriPattern="/taaktypes/{uuid}"/>
        </Receiver>

        <Pipeline>
            <Exits>
                <Exit name="Exit" state="SUCCESS" />
                <Exit name="Reject" state="REJECTED"/>
                <Exit name="Exception" state="ERROR"/>
             </Exits>

            <FixedResultPipe name="InputTaakType" filename="responses/ZaakTypes.xml"/>

            <XmlValidatorPipe name="ValidateInputMessage" schema="xsd/validateGetTaakTypes.xsd" root="root">
                <Forward name="success" path="TaakType"/>
                <Forward name="failure" path="Reject"/>
            </XmlValidatorPipe>
  
            <XsltPipe name="TaakType" styleSheetName="xsl/GetTaakType.xsl"/>

            <JsonPipe name="XmlToJson" direction="XML2JSON">
                <Forward name="success" path="Exit"/>
                <Forward name="failure" path="Exception"/>
            </JsonPipe>
        </Pipeline>
    </Adapter>

    <Adapter name="Action_PostTaak">
        <Receiver name="PostTaak">
            <ApiListener
                name="PostTaak"
                method="POST"
                uriPattern="/taak" />
        </Receiver>

        <Pipeline>
            <Exits>
                <Exit name="Exit" state="SUCCESS" />
                <Exit name="Reject" state="REJECTED" />
                <Exit name="Exception" state="ERROR" />
            </Exits>

            <JsonPipe name="JsonToXml"/>

            <XmlValidatorPipe name="ValidateInputMessage" root="root"
                schema="xsd/ValidatePostTaakInput.xsd">
                <Forward name="failure" path="Reject" />
                <Forward name="error" path="Exception" />
            </XmlValidatorPipe>

            <SenderPipe name="Request_PostZaak">
                <IbisLocalSender javaListener="Request_PostZaak" />
            </SenderPipe>
        </Pipeline>
    </Adapter>

    <Adapter name="Action_DeleteTaak">
        <Receiver name="DeleteTaak">
            <ApiListener
                name="DeleteTaak"
                method="DELETE"
                uriPattern="/taak/{uuid}" />

        </Receiver>

        <Pipeline>
            <Exits>
                <Exit name="Exit" state="SUCCESS" />
                <Exit name="Reject" state="REJECTED" />
                <Exit name="Exception" state="ERROR" />
            </Exits>

            <JsonPipe name="JsonToXml" />

            <XmlValidatorPipe name="ValidateInputMessage" root="root"
                schema="xsd/ValidateDeleteTaakInput.xsd">
                <Forward name="failure" path="Reject" />
                <Forward name="error" path="Exception" />
            </XmlValidatorPipe>

            <SenderPipe name="SwitchConfiguration">
                <IbisLocalSender javaListener="Request_DeleteZaak" />
            </SenderPipe>
        </Pipeline>
    </Adapter>

    <Adapter name="Action_GetTaak">
        <Receiver name="GetTaak">
            <ApiListener
                name="GetTaak"
                uriPattern="/taak/{uuid}" />

        </Receiver>

        <Pipeline>
            <Exits>
                <Exit name="Exit" state="SUCCESS" />
            </Exits>

            <JsonPipe name="JsonToXml" />

            <SenderPipe name="SwitchConfiguration">
                <IbisLocalSender javaListener="Request_GetZaak" />
            </SenderPipe>
        </Pipeline>
    </Adapter>

    <!-- We do not process this, so we just return 501 -->
    <Adapter name="Action_PostTaakCommunicatie">
        <Receiver name="PostTaakCommunicatie">
            <ApiListener
                name="PostTaakCommunicatie"
                method="POST"
                uriPattern="/taak/{uuid}/communicatie" />

        </Receiver>

        <Pipeline>
            <Exits>
                <Exit name="Reject" state="REJECTED" code="501" />
            </Exits>

            <FixedResultPipe name="NotImplemented" returnString="HTTP 501 Not implemented"/>
        </Pipeline>
    </Adapter>

</Module>