<Module xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../FrankConfig.xsd">
    <Adapter name="Request_DeleteZaak">
        <Receiver name="Request_DeleteZaak">
            <JavaListener name="Request_DeleteZaak" />
        </Receiver>

        <Pipeline>
            <Exits>
                <Exit name="Exit" state="SUCCESS" />
                <Exit name="Reject" state="REJECTED" />
                <Exit name="Exception" state="ERROR" />
            </Exits>
            
            <PutSystemDateInSessionPipe name="StoreSystemDate" />
            
            <XsltPipe name="StoreToelichting" getInputFromSessionKey="originalMessage"
            xpathExpression="//reden" storeResultInSessionKey="toelichtingHeader" />
            
            <XsltPipe name="CreateDeleteZaakRequest" getInputFromSessionKey="originalMessage" styleSheetName="xsl/DeleteZaakRequest.xsl">
                <Param name="currentDate" sessionKey="systemDate" />
            </XsltPipe>
            
            <JsonPipe name="XmlToJson" direction="XML2JSON" />
            
            <!-- TODO: Get uuid from the url. Marcel advised to get the code for this from OpenZaak. -->
            <SenderPipe name="SendToESB">
                <HttpSender name="SendToESB" methodType="POST" url="/statussen"
                    headersParams="X-Audit-Toelichting">
                    <Param name="X-Audit-Toelichting" sessionKey="toelichtingHeader" />
                </HttpSender>
            </SenderPipe>

            <!-- TODO: Add error handling -->

        </Pipeline>
    </Adapter>

    <Adapter name="Request_PostZaak">
        <Receiver name="Request_PostZaak">
            <JavaListener name="Request_PostZaak" />
        </Receiver>

        <Pipeline>
            <Exits>
                <Exit name="Exit" state="SUCCESS" />
            </Exits>

            <PutSystemDateInSessionPipe name="StoreSystemDate" />

            <!-- TODO: Replace with ibislocalsender once Seppe's branch has been merged. -->
            <SenderPipe name="RequestMeldingInfo" storeResultInSessionKey="meldingInfo">
                <HttpSender name="SendToESB" methodType="GET" url="/zaken/${uuid}"
                    headersParams="Accept-Crs,Content-Crs">
                    <Param name="Accept-Crs" value="EPSG:4326" />
                    <Param name="Content-Crs" value="EPSG:4326" />
                    <Param name="uuid" sessionKey="originalMessage" xpathExpression="//uuid" />
                </HttpSender>
            </SenderPipe>

            <!-- TODO: Replace with ibislocalsender once Seppe's branch has been merged. -->
            <SenderPipe name="RequestOpdrachtInfo" storeResultInSessionKey="opdrachtInfo">
                <HttpSender name="SendToESB" methodType="GET" url="/zaken/${uuid}"
                    headersParams="Accept-Crs,Content-Crs">
                    <Param name="Accept-Crs" value="EPSG:4326" />
                    <Param name="Content-Crs" value="EPSG:4326" />
                    <Param name="uuid" sessionKey="originalMessage" xpathExpression="//uuid" />
                </HttpSender>
            </SenderPipe>

            <PutInSessionPipe name="StoreToelichtingHeader" sessionKey="toelichtingHeader"
                getInputFromFixedValue="TestValue">
            </PutInSessionPipe>

            <XsltPipe name="CreatePostZaakRequest" styleSheetName="xsl/PostZaakRequest.xsl"
                getInputFromSessionKey="originalMessage">
                <Param name="currentDate" sessionKey="systemDate" />
                <Param name="meldingInfo" sessionKey="meldingInfo" />
                <Param name="opdrachtInfo" sessionKey="opdrachtInfo" />
            </XsltPipe>

            <JsonPipe name="XmlToJson" direction="XML2JSON" />

            <SenderPipe name="SendToESB">
                <HttpSender name="SendToESB" methodType="POST" url="/melding/{meldingUuid}"
                    headersParams="X-Audit-Toelichting,Accept-Crs,Content-Crs">
                    <Param name="X-Audit-Toelichting" sessionKey="toelichtingHeader" />
                    <Param name="Accept-Crs" value="EPSG:4326" />
                    <Param name="Content-Crs" value="EPSG:4326" />
                </HttpSender>
            </SenderPipe>

            <!-- TODO: Add error handling -->

        </Pipeline>
    </Adapter>

    <!-- TODO: Create test case. -->
    <Adapter name="Request_GetZaak">
        <Receiver name="Request_GetZaak">
            <JavaListener name="Request_GetZaak" />
        </Receiver>

        <Pipeline>
            <Exits>
                <Exit name="Exit" state="SUCCESS" />
            </Exits>

            <!-- TODO: Get uuid from the url. Marcel advised to get the code for this from OpenZaak.  -->
            <XsltPipe name="CreateGetZaakRequest" styleSheetName="xsl/GetZaakRequest.xsl"
                getInputFromSessionKey="originalMessage">
                <Param name="currentDate" sessionKey="systemDate" />
                <Param name="meldingInfo" sessionKey="meldingInfo" />
                <Param name="opdrachtInfo" sessionKey="opdrachtInfo" />
            </XsltPipe>

            <SenderPipe name="SendToESB">
                <HttpSender name="SendToESB" methodType="GET" url="/zaken/${uuid}"
                    headersParams="Accept-Crs,Content-Crs">
                    <Param name="Accept-Crs" value="EPSG:4326" />
                    <Param name="Content-Crs" value="EPSG:4326" />
                    <Param name="uuid" sessionKey="originalMessage" xpathExpression="//uuid" />
                </HttpSender>
            </SenderPipe>

            <!-- TODO: Add error handling -->

        </Pipeline>
    </Adapter>

</Module>